---
- name: Add CMDB CI to AAP Inventory if CI does not exist
  hosts: localhost
  gather_facts: no
  collections:
    - infra.aap_configuration

  tasks:
    - name: Ensure inventory exists
      infra.aap_configuration.inventories:
        controller_inventories:
          name: "Hosts from ServiceNow"
          organization: "Default"
          state: present

    - name: 'Ensure CI {{ ansible_eda.event.payload.ci_name }} exists in the Hosts from ServiceNow Inventory'
      infra.aap_configuration.hosts:
        controller_inventories:
          name: '{{ ansible_eda.event.payload.ci_name }}'
          inventory: "Hosts from ServiceNow"
          state: present